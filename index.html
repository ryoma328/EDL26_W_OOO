<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§˜ë‹˜ë“¤ ì˜¤.ìš´.ì™„ ê°œì¸ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .login-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .login-section input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin: 10px;
            width: 250px;
        }

        .login-section button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .login-section button:hover {
            transform: translateY(-2px);
        }

        .login-section button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 1.1em;
        }

        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            height: 400px;
            position: relative;
        }

        .chart-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .recent-activities {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .activity-item:hover {
            background-color: #f8f9ff;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-type {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .streak-badge {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 8px 15px;
            border-radius: 25px;
            font-weight: bold;
            display: inline-block;
        }

        .error-message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                flex-direction: column;
                text-align: center;
            }
            
            .login-section input {
                width: 100%;
                max-width: 300px;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸƒâ€â™‚ï¸ ì˜¤.ìš´.ì™„ ê°œì¸ ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì˜¤ëŠ˜ë„ ìš´ë™ ì™„ë£Œ! ë‹¹ì‹ ì˜ ìš´ë™ ì—¬ì •ì„ í™•ì¸í•´ë³´ì„¸ìš”</p>
        </div>

        <div id="loginSection" class="login-section">
            <h2>ë¡œê·¸ì¸</h2>
            <p>ì´ë©”ì¼ì„ ì…ë ¥í•˜ì—¬ ê°œì¸ ëŒ€ì‹œë³´ë“œë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
            <br>
            <input type="email" id="emailInput" placeholder="ë“±ë¡í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
            <br><br>
            <button id="loginButton">ëŒ€ì‹œë³´ë“œ ë³´ê¸°</button>
            <br><br>
            <p style="color: #666; font-size: 0.9em;">
                * ì‹¤ì œ êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„°ì™€ ì—°ë™ë˜ì—ˆìŠµë‹ˆë‹¤!<br>
                ë“±ë¡ëœ ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ ê°œì¸ë³„ ìš´ë™ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”
            </p>
        </div>

        <div id="dashboardSection" class="hidden">
            <div class="user-info">
                <div>
                    <h2 id="userName">ì‚¬ìš©ìë‹˜</h2>
                    <p id="userEmail"></p>
                </div>
                <div>
                    <button onclick="showAllMembers()" style="background: linear-gradient(45deg, #28a745, #20c997); color: white; border: none; padding: 10px 20px; border-radius: 10px; margin-right: 10px; cursor: pointer;">
                        ğŸ‘¥ ì „ì²´ í˜„í™©
                    </button>
                    <div class="streak-badge" id="streakBadge">
                        ğŸ”¥ 1ì¼ ì—°ì† ìš´ë™ ì¤‘!
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalDays">1</div>
                    <div class="stat-label">ì´ ìš´ë™ì¼ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="thisMonth">1</div>
                    <div class="stat-label">ì´ë²ˆ ë‹¬ ìš´ë™</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="favoriteExercise">ìš´ë™</div>
                    <div class="stat-label">ê°€ì¥ ë§ì´ í•œ ìš´ë™</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="currentStreak">1</div>
                    <div class="stat-label">ì—°ì† ìš´ë™ì¼</div>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <div class="chart-title">ìš´ë™ ì¢…ë¥˜ë³„ í†µê³„</div>
                    <div class="chart-wrapper">
                        <canvas id="exerciseChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">ì›”ë³„ ìš´ë™ í˜„í™©</div>
                    <div class="chart-wrapper">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="recent-activities">
                <div class="chart-title">ìµœê·¼ ìš´ë™ ê¸°ë¡</div>
                <div id="recentActivitiesList">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ì „ì²´ íšŒì› í˜„í™© ì„¹ì…˜ -->
        <div id="allMembersSection" class="hidden">
            <div class="user-info">
                <div>
                    <h2>ğŸ‘¥ ì „ì²´ íšŒì› ìš´ë™ í˜„í™©</h2>
                    <p id="membersSummary">ì´ íšŒì›: 0ëª…, ì´ ìš´ë™ íšŸìˆ˜: 0íšŒ</p>
                </div>
                <div>
                    <button onclick="goBackToPersonal()" style="background: linear-gradient(45deg, #6c757d, #495057); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                        â† ê°œì¸ í˜„í™©
                    </button>
                </div>
            </div>

            <div class="recent-activities">
                <div class="chart-title">ì „ì²´ íšŒì› ìš´ë™ í˜„í™©</div>
                <div style="overflow-x: auto;">
                    <table id="membersTable" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: linear-gradient(45deg, #667eea, #764ba2); color: white;">
                                <th style="padding: 15px; text-align: left; border: 1px solid #ddd;">ìˆœìœ„</th>
                                <th style="padding: 15px; text-align: left; border: 1px solid #ddd;">ì´ë¦„</th>
                                <th style="padding: 15px; text-align: left; border: 1px solid #ddd;">ì£¼ìš” ìš´ë™</th>
                                <th style="padding: 15px; text-align: center; border: 1px solid #ddd;">ì´ ìš´ë™ íšŸìˆ˜</th>
                                <th style="padding: 15px; text-align: left; border: 1px solid #ddd;">ìš´ë™ ì¢…ë¥˜ë³„ íšŸìˆ˜</th>
                                <th style="padding: 15px; text-align: center; border: 1px solid #ddd;">ìµœê·¼ ìš´ë™ì¼</th>
                            </tr>
                        </thead>
                        <tbody id="membersTableBody">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Google Apps Script ì›¹ì•± URL (ì‹¤ì œ ë°°í¬ëœ URLë¡œ ë³€ê²½í•˜ì„¸ìš”)
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxMGCpoSeWVIQm02yPZh7DVZgH3x6s-hAXsjm0MS7XD0TywtRmuCXspT7QyO6m_DGfI/exec';
        
        // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì €ì¥ìš©
        let exerciseChartInstance = null;
        let monthlyChartInstance = null;

        async function loadDashboard() {
            const email = document.getElementById('emailInput').value;
            
            console.log('loadDashboard í•¨ìˆ˜ ì‹œì‘, ì´ë©”ì¼:', email);
            
            if (!email) {
                alert('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë¡œë”© í‘œì‹œ
            const button = document.getElementById('loginButton');
            const originalText = button.textContent;
            button.textContent = 'ë¡œë”© ì¤‘...';
            button.disabled = true;

            console.log('ë°ì´í„° ìš”ì²­ ì‹œì‘...');
            console.log('ì‚¬ìš©í•  URL:', GAS_WEB_APP_URL);

            try {
                const userData = await fetchUserData(email);
                console.log('ë°›ì€ ë°ì´í„°:', userData);

                if (userData.error) {
                    console.error('ì„œë²„ì—ì„œ ì˜¤ë¥˜ ë°˜í™˜:', userData.error);
                    showError(userData.error);
                    return;
                }
                
                // UI ì—…ë°ì´íŠ¸
                console.log('UI ì—…ë°ì´íŠ¸ ì‹œì‘...');
                updateDashboardUI(userData, email);
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                showError(`ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            } finally {
                // ë¡œë”© ì™„ë£Œ
                button.textContent = originalText;
                button.disabled = false;
                console.log('ë¡œë”© ì™„ë£Œ');
            }
        }

        async function fetchUserData(email) {
            const url = `${GAS_WEB_APP_URL}?email=${encodeURIComponent(email)}`;
            console.log('ìš”ì²­ URL:', url);
            
            const response = await fetch(url, {
                method: 'GET',
                mode: 'cors'
            });
            
            console.log('ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
            
            if (!response.ok) {
                throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status} ${response.statusText}`);
            }
            
            const data = await response.json();
            return data;
        }

        function showError(message) {
            const loginSection = document.getElementById('loginSection');
            
            // ê¸°ì¡´ ì—ëŸ¬ ë©”ì‹œì§€ ì œê±°
            const existingError = loginSection.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
            
            // ìƒˆ ì—ëŸ¬ ë©”ì‹œì§€ ì¶”ê°€
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            loginSection.appendChild(errorDiv);
        }

        function updateDashboardUI(userData, email) {
            // UI í‘œì‹œ ì „í™˜
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            
            // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('userName').textContent = userData.name + 'ë‹˜';
            document.getElementById('userEmail').textContent = email;
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('totalDays').textContent = userData.totalDays;
            document.getElementById('thisMonth').textContent = userData.thisMonth;
            document.getElementById('favoriteExercise').textContent = userData.favoriteExercise;
            document.getElementById('currentStreak').textContent = userData.currentStreak;
            
            // ì—°ì† ìš´ë™ì¼ ë°°ì§€ ì—…ë°ì´íŠ¸
            const streakText = userData.currentStreak > 0 
                ? `ğŸ”¥ ${userData.currentStreak}ì¼ ì—°ì† ìš´ë™ ì¤‘!`
                : 'ğŸ’ª ì˜¤ëŠ˜ë¶€í„° ë‹¤ì‹œ ì‹œì‘í•´ìš”!';
            document.getElementById('streakBadge').textContent = streakText;

            // ìµœê·¼ í™œë™ ëª©ë¡ ì—…ë°ì´íŠ¸
            updateRecentActivities(userData.recentActivities);

            // ì°¨íŠ¸ ìƒì„±
            createExerciseChart(userData.exerciseTypes);
            createMonthlyChart(userData.monthlyData);
        }

        function updateRecentActivities(activities) {
            const container = document.getElementById('recentActivitiesList');
            container.innerHTML = '';
            
            if (!activities || activities.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ì•„ì§ ìš´ë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            activities.forEach(activity => {
                const activityDiv = document.createElement('div');
                activityDiv.className = 'activity-item';
                activityDiv.innerHTML = `
                    <div>
                        <span class="activity-type">${activity.type}</span>
                        <span style="margin-left: 15px;">${activity.description}</span>
                    </div>
                    <div style="color: #666;">${activity.date}</div>
                `;
                container.appendChild(activityDiv);
            });
        }

        function createExerciseChart(exerciseData) {
            const ctx = document.getElementById('exerciseChart').getContext('2d');
            
            // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆë‹¤ë©´ ì‚­ì œ
            if (exerciseChartInstance) {
                exerciseChartInstance.destroy();
            }
            
            if (!exerciseData || Object.keys(exerciseData).length === 0) {
                ctx.font = '16px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('ìš´ë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            exerciseChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(exerciseData),
                    datasets: [{
                        data: Object.values(exerciseData),
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#f5576c',
                            '#4facfe',
                            '#43e97b',
                            '#fa709a',
                            '#ff9a9e',
                            '#a8edea',
                            '#fed6e3'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function createMonthlyChart(monthlyData) {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            
            // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆë‹¤ë©´ ì‚­ì œ
            if (monthlyChartInstance) {
                monthlyChartInstance.destroy();
            }
            
            // ë°ì´í„° ê¸¸ì´ì— ë§ì¶° ë¼ë²¨ ìƒì„± (ìµœê·¼ 2ê°œì›”ë§Œ)
            const today = new Date();
            const labels = [];
            const dataLength = monthlyData ? monthlyData.length : 2;
            
            for (let i = dataLength - 1; i >= 0; i--) {
                const targetDate = new Date(today.getFullYear(), today.getMonth() - i, 1);
                const monthLabel = targetDate.toLocaleDateString('ko-KR', { month: 'long' });
                labels.push(monthLabel);
            }
            
            console.log('ì›”ë³„ ì°¨íŠ¸ ë¼ë²¨:', labels);
            console.log('ì›”ë³„ ì°¨íŠ¸ ë°ì´í„°:', monthlyData);
            console.log('ë°ì´í„° ê¸¸ì´:', dataLength);
            
            if (!monthlyData || monthlyData.length === 0) {
                ctx.font = '16px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('ì›”ë³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            monthlyChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels, // ë°ì´í„° ê¸¸ì´ì— ë§ì¶˜ ë¼ë²¨
                    datasets: [{
                        label: 'ì›”ë³„ ìš´ë™ íšŸìˆ˜',
                        data: monthlyData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                stepSize: 1
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });
        }

        // ì „ì²´ íšŒì› í˜„í™© ë³´ê¸°
        async function showAllMembers() {
            console.log('ì „ì²´ íšŒì› í˜„í™© ìš”ì²­ ì‹œì‘');
            
            try {
                const membersData = await fetchAllMembersData();
                console.log('ì „ì²´ íšŒì› ë°ì´í„°:', membersData);
                
                if (membersData.error) {
                    alert('ì „ì²´ íšŒì› ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + membersData.error);
                    return;
                }
                
                // ì „ì²´ íšŒì› í˜„í™© í™”ë©´ìœ¼ë¡œ ì „í™˜
                document.getElementById('dashboardSection').classList.add('hidden');
                document.getElementById('allMembersSection').classList.remove('hidden');
                
                // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById('membersSummary').textContent = 
                    `ì´ íšŒì›: ${membersData.totalMembers}ëª…, ì´ ìš´ë™ íšŸìˆ˜: ${membersData.totalExercises}íšŒ`;
                
                // í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateMembersTable(membersData.members);
                
            } catch (error) {
                console.error('ì „ì²´ íšŒì› ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                alert('ì „ì²´ íšŒì› ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function fetchAllMembersData() {
            const url = `${GAS_WEB_APP_URL}?action=getAllMembers`;
            console.log('ì „ì²´ íšŒì› ìš”ì²­ URL:', url);
            
            const response = await fetch(url, {
                method: 'GET',
                mode: 'cors'
            });
            
            console.log('ì „ì²´ íšŒì› ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
            
            if (!response.ok) {
                throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status} ${response.statusText}`);
            }
            
            const data = await response.json();
            return data;
        }

        function updateMembersTable(members) {
            const tbody = document.getElementById('membersTableBody');
            tbody.innerHTML = '';
            
            if (!members || members.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #666;">ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            members.forEach((member, index) => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #eee';
                row.style.transition = 'background-color 0.2s';
                
                // ìˆœìœ„ì— ë”°ë¥¸ ë°°ê²½ìƒ‰
                let rankStyle = '';
                if (index === 0) rankStyle = 'background: linear-gradient(45deg, #ffd700, #ffed4a); color: #333;'; // ê¸ˆë©”ë‹¬
                else if (index === 1) rankStyle = 'background: linear-gradient(45deg, #c0c0c0, #e2e8f0); color: #333;'; // ì€ë©”ë‹¬
                else if (index === 2) rankStyle = 'background: linear-gradient(45deg, #cd7f32, #d69e2e); color: white;'; // ë™ë©”ë‹¬
                
                // ìš´ë™ ì¢…ë¥˜ë³„ íšŸìˆ˜ ë¬¸ìì—´ ìƒì„±
                const exerciseDetails = Object.entries(member.exercises)
                    .map(([exercise, count]) => `${exercise}(${count})`)
                    .join(', ');
                
                row.innerHTML = `
                    <td style="padding: 15px; border: 1px solid #ddd; text-align: center; ${rankStyle}">
                        ${index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : index + 1}
                    </td>
                    <td style="padding: 15px; border: 1px solid #ddd; font-weight: bold;">
                        ${member.name}
                    </td>
                    <td style="padding: 15px; border: 1px solid #ddd;">
                        <span style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.9em;">
                            ${member.favoriteExercise}
                        </span>
                    </td>
                    <td style="padding: 15px; border: 1px solid #ddd; text-align: center; font-weight: bold; color: #667eea; font-size: 1.2em;">
                        ${member.totalCount}íšŒ
                    </td>
                    <td style="padding: 15px; border: 1px solid #ddd; font-size: 0.9em;">
                        ${exerciseDetails}
                    </td>
                    <td style="padding: 15px; border: 1px solid #ddd; text-align: center; color: #666;">
                        ${member.lastExerciseDate || '-'}
                    </td>
                `;
                
                // í˜¸ë²„ íš¨ê³¼
                row.addEventListener('mouseover', function() {
                    if (index > 2) this.style.backgroundColor = '#f8f9ff';
                });
                row.addEventListener('mouseout', function() {
                    if (index > 2) this.style.backgroundColor = '';
                });
                
                tbody.appendChild(row);
            });
        }

        function goBackToPersonal() {
            document.getElementById('allMembersSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ì˜¤.ìš´.ì™„ ëŒ€ì‹œë³´ë“œê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            console.log('Apps Script URL:', GAS_WEB_APP_URL);
            
            // URL ìœ íš¨ì„± ê²€ì‚¬
            if (GAS_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE' || 
                !GAS_WEB_APP_URL.includes('script.google.com')) {
                console.error('âš ï¸ ì›¹ì•± URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                showError('ì›¹ì•± URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê°œë°œìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
            }

            // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const loginButton = document.getElementById('loginButton');
            if (loginButton) {
                loginButton.addEventListener('click', loadDashboard);
            }

            // ì—”í„°í‚¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const emailInput = document.getElementById('emailInput');
            if (emailInput) {
                emailInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        loadDashboard();
                    }
                });
            }
        });
    </script>
</body>
</html>
